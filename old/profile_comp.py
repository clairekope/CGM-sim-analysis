# coding: utf-8
import yt
import matplotlib.pyplot as plt
import numpy as np

ds = yt.load("DD0000/DD0000")

sph = ds.sphere([0.5,0.5,0.5], (300,'kpc'))
sph2 = ds.sphere([0.5,0.5,0.5], (30,'kpc'))
shell = sph-sph2
shell.center=[0.5,0.5,0.5]

prof = yt.create_profile(sph,'radius',
                         ['H_p0_density','He_p1_density','temperature','density','entropy','pressure'],
                         logs={'radius':False},
                         extrema={'radius':(30*yt.units.kpc,300*yt.units.kpc)},
                         units={'radius':'kpc'})

r = [ 30.        , 35.51020408, 41.02040816, 46.53061224, 52.04081633,
  57.55102041, 63.06122449, 68.57142857, 74.08163265, 79.59183673,
  85.10204082, 90.6122449 , 96.12244898,101.63265306,107.14285714,
 112.65306122,118.16326531,123.67346939,129.18367347,134.69387755,
 140.20408163,145.71428571,151.2244898 ,156.73469388,162.24489796,
 167.75510204,173.26530612,178.7755102 ,184.28571429,189.79591837,
 195.30612245,200.81632653,206.32653061,211.83673469,217.34693878,
 222.85714286,228.36734694,233.87755102,239.3877551 ,244.89795918,
 250.40816327,255.91836735,261.42857143,266.93877551,272.44897959,
 277.95918367,283.46938776,288.97959184,294.48979592,300.        ]

HI= [4.13330536e-35,3.39913024e-35,2.87075966e-35,2.47322229e-35,
 2.16420369e-35,1.91829191e-35,1.71780967e-35,1.55180079e-35,
 1.41261979e-35,1.29407338e-35,1.19203064e-35,1.10336718e-35,
 1.02567747e-35,9.57080810e-36,8.96087142e-36,8.41502021e-36,
 7.92358064e-36,7.47864595e-36,7.07370079e-36,6.70333722e-36,
 6.36364051e-36,6.05177305e-36,5.76294682e-36,5.49442062e-36,
 5.24486188e-36,5.01263870e-36,4.79457182e-36,4.59013802e-36,
 4.39851486e-36,4.21706005e-36,4.04663027e-36,3.88501355e-36,
 3.73180223e-36,3.58680252e-36,3.44838552e-36,3.31744952e-36,
 3.19186078e-36,3.07294817e-36,2.95857861e-36,2.85004632e-36,
 2.74556717e-36,2.64608183e-36,2.55038589e-36,2.45885691e-36,
 2.37101321e-36,2.28654115e-36,2.20575961e-36,2.12771313e-36,
 2.05320002e-36,1.98128904e-36]

HeII = [9.03730122e-34,7.63505604e-34,6.62859240e-34,5.87344778e-34,
 5.28794930e-34,4.82309315e-34,4.44489410e-34,4.13229625e-34,
 3.87063840e-34,3.64810939e-34,3.45682171e-34,3.29081427e-34,
 3.14549640e-34,3.01727497e-34,2.90329790e-34,2.80127374e-34,
 2.70934234e-34,2.62598030e-34,2.54993089e-34,2.48015115e-34,
 2.41582832e-34,2.35628241e-34,2.30072454e-34,2.24863395e-34,
 2.19960635e-34,2.15321722e-34,2.10908042e-34,2.06691411e-34,
 2.02641136e-34,1.98739933e-34,1.94956576e-34,1.91281152e-34,
 1.87696191e-34,1.84179578e-34,1.80736104e-34,1.77328125e-34,
 1.73981265e-34,1.70645829e-34,1.67361300e-34,1.64074187e-34,
 1.60827122e-34,1.57574041e-34,1.54347971e-34,1.51122776e-34,
 1.47908654e-34,1.44711692e-34,1.41506553e-34,1.38335878e-34,
 1.35148864e-34,1.31991737e-34]

rho = [3.10952733e-28,2.40770855e-28,1.91479488e-28,1.55455203e-28,
 1.28336272e-28,1.07442534e-28,9.10375453e-29,7.79500066e-29,
 6.73644841e-29,5.86986483e-29,5.15277574e-29,4.55363938e-29,
 4.04866396e-29,3.61965420e-29,3.25252198e-29,2.93623662e-29,
 2.66207284e-29,2.42306396e-29,2.21359920e-29,2.02912338e-29,
 1.86591069e-29,1.72089233e-29,1.59152425e-29,1.47568439e-29,
 1.37159261e-29,1.27774741e-29,1.19287595e-29,1.11589395e-29,
 1.04587357e-29,9.82017419e-30,9.23637409e-30,8.70137450e-30,
 8.20999251e-30,7.75770579e-30,7.34055516e-30,6.95506341e-30,
 6.59816730e-30,6.26716039e-30,5.95964483e-30,5.67349050e-30,
 5.40680029e-30,5.15788044e-30,4.92521521e-30,4.70744507e-30,
 4.50334799e-30,4.31182322e-30,4.13187725e-30,3.96261165e-30,
 3.80321243e-30,3.65294078e-30]

T=[1287100.83526448,1223339.28400821,1163335.68760578,1107197.07359854,
 1054947.43433151,1006503.69442844, 961697.65946905, 920306.88344405,
  882081.48909674, 846763.80089843, 814101.28335007, 783854.29860816,
  755800.21423002, 729735.09633075, 705473.88947629, 682849.70353111,
  661712.61708204, 641928.25876464, 623376.3273699 , 605949.14544032,
  589550.29848139, 574093.38513312, 559500.88725057, 545703.15916125,
  532637.52996368, 520247.51000338, 508482.09157374, 497295.13377203,
  486644.82187425, 476493.19231002, 466805.71516064, 457550.92696984,
  448700.10749549, 440226.99480905, 432107.53385726, 424319.6542315 ,
  416843.07344793, 409659.12252944, 402750.59110571, 396101.58961675,
  389697.42652449, 383524.498713  , 377570.19349611, 371822.8008569 ,
  366271.43472068, 360905.96221661, 355716.94001506, 350695.55694264,
  345833.58217553, 341123.31839765]

K = 2.6 * np.array(r)**0.71
n_e = np.array(rho)/(2*0.59*1.67e-24)
P = 1.1/0.59 * K/6.242e8 * n_e**(5/3)
fig, ax = plt.subplots(nrows=2, ncols=3, sharex=True)

ax[0,0].semilogy(prof.x, prof['entropy'], label='Sim ICs')
ax[0,0].semilogy(r, K, label='Analytic+Pygrackle')
ax[0,0].set_ylabel('entropy')
ax[0,0].legend()

ax[1,0].semilogy(prof.x, prof['pressure'])
ax[1,0].semilogy(r, P)
ax[1,0].set_ylabel('pressure')

ax[0,1].semilogy(prof.x, prof['density'])
ax[0,1].semilogy(r, rho)
ax[0,1].set_ylabel('density')

ax[1,1].semilogy(prof.x, prof['temperature'])
ax[1,1].semilogy(r, T)
ax[1,1].set_ylabel('temperature')
ax[1,1].set_ylim(1e5,2e6)

ax[0,2].semilogy(prof.x, prof['H_p0_density'])
ax[0,2].semilogy(r, HI)
ax[0,2].set_ylabel('HI')

ax[1,2].semilogy(prof.x, prof['He_p1_density'])
ax[1,2].semilogy(r, HeII)
ax[1,2].set_ylabel('HeII')

plt.show()
